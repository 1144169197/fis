/*
 * fis
 * http://web.baidu.com/
 */

'use strict';

function deploy(dest, file){
    console.log('deploy [' + file.realpath + '] to [' + dest.to + file.release + ']');
}

module.exports = function(dest, collection, fis){
    var settings = fis.config.get('deploy', {});
    var dests = [];
    dest.split(/,/g).forEach(function(d){
        if(settings[d]){
            var from = settings[d].from;
            if(from){
                settings[d].from = '/' + from.replace(/^\//, '');
            } else {
                settings[d].from = '/';
            }
            dests.push(settings[d]);
        } else if(/^output\b/.test(d)){ //local
            dests.push({
                from : '/',
                to   : '/' + d
            });
        } else {
            fis.log.error('invalid deploy destination options [' + d + ']');
        }
    });
    fis.util.map(collection, function(subpath, file){
        dests.forEach(function(d){
            if(file.release.indexOf(d.from) === 0){
                deploy(d, file);
            }
        });
    });
};