/*
 * fis
 * http://web.baidu.com/
 */

'use strict';

module.exports = function(content, file, conf, fis){
    var map = fis.compile.lang;
    var reg = /\burl\s*\(\s*("(?:[^\\"]|\\[\s\S])+"|'(?:[^\\']|\\[\s\S])+'|[^)}]+)\s*\)|\bsrc\s*=\s*("(?:[^\\"]|\\[\s\S])+"|'(?:[^\\']|\\[\s\S])+'|[^\s}]+)/g;
    return content.replace(reg, function(m, url, filter){
        if(url){
            var info = fis.util.query(url);
            var key = /[?&]inline(?:[=&'"]|$)/.test(info.query) ? 'embed' : 'uri';
            m = 'url(' + map[key]['ld'] + url + map[key]['rd'] + ')';
        } else if(filter) {
            m = 'src=' + map.uri.ld + filter + map.uri.rd;
        }
        return m;
    });
};